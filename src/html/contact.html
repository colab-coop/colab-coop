@@include('../templates/_head.tpl')

<body class="contact">

  @@include('../templates/_homenav.tpl')

  <main>
    <div class="container--text">
      <section class="callout">Tell us about your project with the <a href="/project-check-in">Project Check-In</a>.</section>
      <div class="spacing--mid-x"></div>
      <form class="form-base form-contact" id="form-contact">
        <div class="grid-parent">
          <div class="form-field-wrap grid-child">
            <label for="name" class="required-label">Name</label>
            <input type="text" class="required" name="name" id="name" required>
          </div>

          <div class="form-field-wrap grid-child">
            <label for="company">Organization or Company</label>
            <input type="text" name="company" id="company">
          </div>
        </div> <!-- /grid-parent -->

        <div class="grid-parent">
          <div class="form-field-wrap grid-child">
            <label for="email" class="required-label">Email</label>
            <input type="email" class="required" name="email" id="email" required>
          </div>

          <div class="form-field-wrap grid-child">
            <label for="tel">Phone</label>
            <input type="tel" name="tel" id="tel">
          </div>
        </div> <!-- /grid-parent -->

        <div class="form-field-wrap">
          <label for="message" class="required-label">Message</label>
          <textarea cols="40" class="required" rows="4" name="message" id="message"></textarea>
        </div>

        <div class="form-field-wrap center-text">
          <div class="spacing--sm">
            <input type="submit" value="Send" id="submit" class="button--brand-outline color-red" />
            <input type="reset" value="Reset" id="reset" style="display:none;" />
            <div id="success" hidden>Thanks for your message. We'll be in touch.</div>
            <div id="error" hidden>Errors were found. Please rectify and re-submit the form. <span id="errorMsg"></span></div>
          </div>
        </div>
      </form>

      <div class="spacing--mid"></div>

      <section>
        <div class="address-colab-block">
          <p>CoLab is located in Ithaca, New York with collaborators worldwide.</p>
          <div class="grid-parent address-colab">
            <div class="col-50-flt">
              <div>141 The Commons, Suite 300 <br>Ithaca, NY 14850</div>
            </div>
            <div class="col-50-flt">
              <div>(888) 426-5996 <br> <a href="mailto:core@colab.coop">core@colab.coop</a></div>
            </div>
          </div>
        </div> <!-- /address-colab-block -->
      </section>
    </div> <!-- /container--text -->

    <script src="https://maps.googleapis.com/maps/api/js"></script>
    <script>
      function initialize() {
        var mapCanvas = document.getElementById('map-canvas');
        var myLatLng = new google.maps.LatLng(42.4422877, -76.4983749)
        var mapOptions = {
          center: new google.maps.LatLng(42.4422877, -76.4983749),
          zoom: 15,
          scrollwheel: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          styles: [{"featureType":"administrative","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"visibility":"simplified"},{"color":"#fcfcfc"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"visibility":"simplified"},{"color":"#fcfcfc"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"visibility":"simplified"},{"color":"#dddddd"}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"visibility":"simplified"},{"color":"#dddddd"}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"visibility":"simplified"},{"color":"#eeeeee"}]},{"featureType":"water","elementType":"geometry","stylers":[{"visibility":"simplified"},{"color":"#dddddd"}]}]
        }
        var map = new google.maps.Map(mapCanvas, mapOptions)

      var iconBase = '/assets/img/';
        var marker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        icon: iconBase + 'google-maps-marker.png'
      });

      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    <section>
      <div class="address-map-block">
        <div id="map-canvas"></div>
      </div> <!-- /address-map-block -->
    </section>
  </main>

  <script>
    $('#form-contact').submit(function (e) {
      e.preventDefault();

      function clearform () {
        //$('#email, #name, #message')[0].reset(); //.val('');
        //$('#name').val('');
        //$('#message').val('');
        $('#reset').trigger('click');

      }

      // Simple Validation.
      $validated = 'true';
      $(this).find('.required').each( function(){
        if ($(this).val().trim() == '') {
          $(this).addClass('error-empty');
          $validated = 'false';
        }
        else{
          $(this).removeClass('error-empty');
        }
      });

      if ($validated == 'false') {
        $('#errorMsg').text('Please include all required fields');
        $('#error').fadeIn();
          window.setTimeout(function () {
            $('#error').fadeOut();
          }, 3000);
      }
      else {
        //disable submit button
        $(this).find('input[type="submit"]').each( function(){
          $(this).attr('disabled', 'disabled').addClass('busy');
        });


        $.ajax({
          type: 'POST',
          datatype: 'jsonp',
          headers: {
            'Accept': 'application/json'
          },
          url: window.location.protocol + '//' + window.location.hostname + ':8113/form',
          data: JSON.stringify({
            email: $('#email').val(),
            name: $('#name').val(),
            msg: $('#message').val()
          }),
          processData: false,
          contentType: 'application/json',
          success: function (response) {
            console.log('got success: ', response);
            clearform();
            $('#success').fadeIn();
            $('input[type="submit"].busy').removeAttr('disabled').removeClass('busy');
            /*
            window.setTimeout(function () {
              $('#success').fadeOut();
            }, 3000);
            */
          },
          error: function (jqXHR, status, errorThrown) {
            console.log('got error: ', jqXHR);
            $('#errorMsg').innerText(errorThrown);
            $('#error').fadeIn();
            window.setTimeout(function () {
              $('#error').fadeOut();
            }, 3000);
          }
        })

      }
    });
  </script>

  @@include('../templates/_footer.tpl')

  @@include('../templates/_tail.tpl')
